<!DOCTYPE html><html lang="en"><head><title>spec\FilesizeWatcher_ReduxSpec</title></head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0"><meta name="groc-relative-root" content="../"><meta name="groc-document-path" content="spec\FilesizeWatcher_ReduxSpec"><meta name="groc-project-path" content="spec\FilesizeWatcher_ReduxSpec.js"><link rel="stylesheet" type="text/css" media="all" href="../assets/style.css"><script type="text/javascript" src="../assets/behavior.js"></script><body><div id="meta"><div class="file-path">spec\FilesizeWatcher_ReduxSpec.js</div></div><div id="document"><div class="segment"><div class="code"><div class="wrapper"><span class="hljs-pi">'use strict'</span>;

<span class="hljs-keyword">var</span> FileSizeWatcher_Redux = <span class="hljs-built_in">require</span>(<span class="hljs-string">'..\\src\\FileSizeWatcher_Redux'</span>);
<span class="hljs-keyword">var</span> exec = <span class="hljs-built_in">require</span>(<span class="hljs-string">'child_process'</span>).exec;

describe(<span class="hljs-string">'FileSizeWatcher_Redux'</span>,
  <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{

    <span class="hljs-keyword">var</span> watcher;

    afterEach(
      <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{
        watcher.stop();
    });

    it(<span class="hljs-string">'should fire a "grew" event when the file grew in size'</span>, 
      <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">done</span>)</span>{

        <span class="hljs-keyword">var</span> path = <span class="hljs-string">'..\\FileSizeWatcher_Redux.test'</span>;

        exec(<span class="hljs-string">'rm -force '</span> + path + <span class="hljs-string">' ; echo "test" &gt; '</span> + path,
          <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{

            watcher = <span class="hljs-keyword">new</span> FileSizeWatcher_Redux(path);

            watcher.on(<span class="hljs-string">'grew'</span>,
              <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">gain</span>)</span>{
                expect(gain).toBe(<span class="hljs-number">9</span>);
                done();
            });

            exec(<span class="hljs-string">'echo "test" &gt; '</span> + path,
              <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{
            });
        });
    });

    it(<span class="hljs-string">'should fire a "shrank" event when the file shrank in size'</span>,
      <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">done</span>)</span>{

        <span class="hljs-keyword">var</span> path = <span class="hljs-string">'..\\FileSizeWatcher_Redux.test'</span>;</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Recreate the file as empty</p></div></div><div class="code"><div class="wrapper">        exec(<span class="hljs-string">'rm -force '</span> + path + <span class="hljs-string">' ; touch '</span> + path,
          <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{

            watcher = <span class="hljs-keyword">new</span> FileSizeWatcher_Redux(path);

            watcher.on(<span class="hljs-string">'shrank'</span>,
              <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">loss</span>)</span>{

                expect(loss).toBe(<span class="hljs-number">3</span>);
                done();
            });

            exec(<span class="hljs-string">'echo "a" &gt; '</span> + path,
              <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{
            });
        });
    });


    it(<span class="hljs-string">'should fire "error" if path is not of extension ".test".'</span>,
      <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">done</span>) </span>{
        <span class="hljs-keyword">var</span> path = <span class="hljs-string">'..\\FileSizeWatcher_Redux.tes'</span>;

        watcher = <span class="hljs-keyword">new</span> FileSizeWatcher_Redux(path);

        watcher.on(<span class="hljs-string">'error'</span>,
          <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">err</span>)</span>{
            expect(err).toBe(<span class="hljs-string">'Path is not of extenstion ".test".'</span>);
            done();
        });
    });
});</div></div></div></div></body></html>